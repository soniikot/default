apiVersion: dsdf.7sg.ai/v1
kind: DataSourceDefinition
metadata:
  name: downloaded-taxi-data-streaming-to-crusoe
  tags:
    env: prod
home:
  tdfRef: azure-east
connection:
  type: object-store
  provider: adls-gen2
  endpoint: abfss://<container>@<storage-account>.dfs.core.windows.net/
  resource: taxi-tripdata/
  format: parquet
  notes: NYC TLC parquet files (yellow/green/fhv/fhvhv) staged under src_data and
    uploaded to ADLS for Synapse.
  paths:
    yellow: taxi-tripdata/yellow_tripdata_{year}-{month}.parquet
    green: taxi-tripdata/green_tripdata_{year}-{month}.parquet
    fhv: taxi-tripdata/fhv_tripdata_{year}-{month}.parquet
    fhvhv: taxi-tripdata/fhvhv_tripdata_{year}-{month}.parquet
  sourceUrls:
    tripdata: https://d37ci6vzurychx.cloudfront.net/trip-data/
auth:
  method: azure-managed-identity
  secretRefs: []
secrets:
  provider: inherit
  inheritFromWdf: true
  secretRefs: []
replication:
  enabled: true
  method: streaming
  targets:
  - tdfRef: crusoe
    destination:
      type: object-store
      provider: s3
      endpoint: https://<vast-s3-endpoint>
      resource: s3://<vast-bucket>/taxi-tripdata/
      format: parquet
    transport:
      type: kafka
      serviceRefs:
        source:
          tdfRef: azure-east
          service: kafka-bridge
        target:
          tdfRef: crusoe
          service: kafka-bridge
      topic: taxi-tripdata.parquet
      security:
        mode: sasl_ssl
        authRef: kafka-credentials
